@extends('frontend.layouts.master')
@section('title','Cart Page')
@section('main-content')
<!-- Breadcrumbs -->
<div class="breadcrumbs">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <div class="bread-inner">
                    <ul class="bread-list">
                        <li><a href="{{('home')}}">Trang ch·ªß<i class="ti-arrow-right"></i></a></li>
                        <li class="active"><a href="">Gi·ªè h√†ng</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- End Breadcrumbs -->

<!-- Shopping Cart -->
<div class="shopping-cart section">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <!-- Shopping Summery -->
                <table class="table shopping-summery">
                    <thead>
                        <tr class="main-hading">
                            <th>S·∫£n ph·∫©m</th>
                            <th>T√™n</th>
                            <th class="text-center">ƒê∆°n gi√°</th>
                            <th class="text-center">S·ªë l∆∞·ª£ng</th>
                            <th class="text-center">T·ªïng c·ªông</th>
                            <th class="text-center"><i class="ti-trash remove-icon"></i></th>
                        </tr>
                    </thead>
                    <tbody id="cart_item_list">
                        <form action="{{route('cart.update')}}" method="POST">
                            @csrf
                            @if(Helper::getAllProductFromCart())
                            @foreach(Helper::getAllProductFromCart() as $key=>$cart)
                            <tr>
                                @php
                                $photo=explode(',',$cart->product['photo']);
                                @endphp
                                <td class="image" data-title="No"><img src="{{$photo[0]}}" alt="{{$photo[0]}}"></td>
                                <td class="product-des" data-title="Description">
                                    <p class="product-name"><a href="{{route('product-detail',$cart->product['slug'])}}"
                                            target="_blank">{{$cart->product['title']}}</a></p>
                                    <p class="product-des">{!!($cart['summary']) !!}</p>
                                </td>
                                @php
                                $exchange_rate = 23000;
                                $amount_vnd = $cart['amount'] * $exchange_rate;
                                @endphp
                                <td class="price" data-title="Price"><span>{{number_format($amount_vnd,0)}} VND</span>
                                </td>
                                <td class="qty" data-title="Qty">
                                    <!-- Input Order -->
                                    <div class="input-group">
                                        <div class="button minus">
                                            <button type="button" class="btn btn-primary btn-number" disabled="disabled"
                                                data-type="minus" data-field="quant[{{$key}}]">
                                                <i class="ti-minus"></i>
                                            </button>
                                        </div>
                                        <input type="text" name="quant[{{$key}}]" class="input-number" data-min="1"
                                            data-max="100" value="{{$cart->quantity}}">
                                        <input type="hidden" name="qty_id[]" value="{{$cart->id}}">
                                        <div class="button plus">
                                            <button type="button" class="btn btn-primary btn-number" data-type="plus"
                                                data-field="quant[{{$key}}]">
                                                <i class="ti-plus"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <!--/ End Input Order -->
                                </td>

                                @php
                                $exchange_rate = 23000;
                                $price_vnd = $cart['price'] * $exchange_rate;
                                @endphp
                                <td class="total-amount cart_single_price" data-title="Total"><span
                                        class="money">{{number_format($price_vnd, 0)}} VND</span></td>

                                <td class="action" data-title="Remove"><a href="{{route('cart-delete',$cart->id)}}"><i
                                            class="ti-trash remove-icon"></i></a></td>
                            </tr>
                            @endforeach
                            <track>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td class="float-right">
                                <button class="btn float-right" type="submit">C·∫≠p nh·∫≠t</button>
                            </td>
                            </track>
                            @else
                            <tr>
                                <td class="text-center">
                                    Kh√¥ng c√≥ g√¨ trong gi·ªè h√†ng c·∫£ ü•≤ <a href="{{route('product-grids')}}"
                                        style="color:blue;">H√£y mua h√†ng ƒëi</a>

                                </td>
                            </tr>
                            @endif

                        </form>
                    </tbody>
                </table>
                <!--/ End Shopping Summery -->
            </div>
        </div>
        <div class="row">
            <div class="col-12">
                <!-- Total Amount -->
                <div class="total-amount">
                    <div class="row">
                        <div class="col-lg-8 col-md-5 col-12">
                            <div class="left">
                                <div class="coupon">
                                    <form action="{{route('coupon-store')}}" method="POST">
                                        @csrf
                                        <input name="code" placeholder="Enter Valid Coupon">
                                        <button class="btn">√Åp d·ª•ng m√£ gi·∫£m gi√°</button>
                                    </form>
                                </div>
                                {{-- <div class="checkbox">`
										@php
											$shipping=DB::table('shippings')->where('status','active')->limit(1)->get();
										@endphp
										<label class="checkbox-inline" for="2"><input name="news" id="2" type="checkbox" onchange="showMe('shipping');"> Shipping</label>
									</div> --}}
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-7 col-12">
                            <div class="right">
                                @php
                                $exchange_rate = 23000; // Replace with the current exchange rate
                                $total_cart_price_vnd = Helper::totalCartPrice() * $exchange_rate;
                                $coupon_value_vnd = session()->has('coupon') ? Session::get('coupon')['value'] *
                                $exchange_rate : 0;
                                $total_amount_vnd = $total_cart_price_vnd - $coupon_value_vnd;
                                @endphp
                                <ul>
                                    <li class="order_subtotal" data-price="{{Helper::totalCartPrice()}}">Gi√°
                                        g·ªëc<span>{{number_format($total_cart_price_vnd,0)}} VND</span></li>

                                    @if(session()->has('coupon'))
                                    <li class="coupon_price" data-price="{{Session::get('coupon')['value']}}">Gi·∫£m
                                        gi√°<span>{{number_format($coupon_value_vnd,0)}} VND</span></li>
                                    @endif
                                    <!-- @php
                                    $total_amount=Helper::totalCartPrice();
                                    if(session()->has('coupon')){
                                    $total_amount=$total_amount-Session::get('coupon')['value'];
                                    }
                                    @endphp -->
                                    @if(session()->has('coupon'))
                                    <li class="last" id="order_total_price">Gi√°
                                        ti·ªÅn<span>{{number_format($total_amount_vnd,0)}} VND</span></li>
                                    @else
                                    <li class="last" id="order_total_price">Gi√°
                                        ti·ªÅn<span>{{number_format($total_amount_vnd,0)}} VND</span></li>
                                    @endif
                                </ul>
                                <div class="button5">
                                    <a href="{{route('checkout')}}" class="btn">Thanh to√°n</a>
                                    <a href="{{route('product-grids')}}" class="btn">Ti·∫øp t·ª•c mua s·∫Øm</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!--/ End Total Amount -->
            </div>
        </div>
    </div>
</div>
<!--/ End Shopping Cart -->

<!-- Start Shop Services Area  -->
<section class="shop-services section">
    <div class="container">
        <div class="row">
            <div class="col-lg-3 col-md-6 col-12">
                <!-- Start Single Service -->
                <div class="single-service">
                    <i class="ti-rocket"></i>
                    <h4>Free shiping</h4>
                    <p>ƒê∆°n h√†ng tr√™n 100.000 VND</p>
                </div>
                <!-- End Single Service -->
            </div>
            <div class="col-lg-3 col-md-6 col-12">
                <!-- Start Single Service -->
                <div class="single-service">
                    <i class="ti-reload"></i>
                    <h4>Free Return</h4>
                    <p>Trong v√≤ng 30 ng√†y</p>
                </div>
                <!-- End Single Service -->
            </div>
            <div class="col-lg-3 col-md-6 col-12">
                <!-- Start Single Service -->
                <div class="single-service">
                    <i class="ti-lock"></i>
                    <h4>Sucure Payment</h4>
                    <p>B·∫£o m·∫≠t thanh to√°n 100%</p>
                </div>
                <!-- End Single Service -->
            </div>
            <div class="col-lg-3 col-md-6 col-12">
                <!-- Start Single Service -->
                <div class="single-service">
                    <i class="ti-tag"></i>
                    <h4>Best Peice</h4>
                    <p>Gi√° c·∫£ h·ª£p l√≠</p>
                </div>
                <!-- End Single Service -->
            </div>
        </div>
    </div>
</section>
<!-- End Shop Newsletter -->

<!-- Start Shop Newsletter  -->
@include('frontend.layouts.newsletter')
<!-- End Shop Newsletter -->

@endsection
@push('styles')
<style>
li.shipping {
    display: inline-flex;
    width: 100%;
    font-size: 14px;
}

li.shipping .input-group-icon {
    width: 100%;
    margin-left: 10px;
}

.input-group-icon .icon {
    position: absolute;
    left: 20px;
    top: 0;
    line-height: 40px;
    z-index: 3;
}

.form-select {
    height: 30px;
    width: 100%;
}

.form-select .nice-select {
    border: none;
    border-radius: 0px;
    height: 40px;
    background: #f6f6f6 !important;
    padding-left: 45px;
    padding-right: 40px;
    width: 100%;
}

.list li {
    margin-bottom: 0 !important;
}

.list li:hover {
    background: #F7941D !important;
    color: white !important;
}

.form-select .nice-select::after {
    top: 14px;
}
</style>
@endpush
@push('scripts')
<script src="{{asset('frontend/js/nice-select/js/jquery.nice-select.min.js')}}"></script>
<script src="{{ asset('frontend/js/select2/js/select2.min.js') }}"></script>
<script>
$(document).ready(function() {
    $("select.select2").select2();
});
$('select.nice-select').niceSelect();
</script>
<script>
$(document).ready(function() {
    $('.shipping select[name=shipping]').change(function() {
        let cost = parseFloat($(this).find('option:selected').data('price')) || 0;
        let subtotal = parseFloat($('.order_subtotal').data('price'));
        let coupon = parseFloat($('.coupon_price').data('price')) || 0;
        // alert(coupon);
        $('#order_total_price span').text('$' + (subtotal + cost - coupon).toFixed(2));
    });

});
</script>

@endpush
